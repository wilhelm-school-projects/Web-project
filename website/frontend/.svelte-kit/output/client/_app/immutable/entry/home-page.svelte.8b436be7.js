var qt=Object.defineProperty;var Rt=(i,t,e)=>t in i?qt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var g=(i,t,e)=>(Rt(i,typeof t!="symbol"?t+"":t,e),e);import{N as pt,S as st,i as nt,s as rt,k as h,a as k,y as Y,l as d,m as v,c as P,z as Q,h as l,n,b as J,G as r,A as Z,g as tt,d as et,P as Ut,B as at,o as Nt,q as T,r as M,H as U,J as Pt,K as $t,M as jt,L as Wt,O as Gt}from"../chunks/index.c5e23121.js";import{B as Jt}from"../chunks/ButtonLogout.d88945c9.js";import{s as Ft}from"../chunks/index.eaa444e6.js";import{d as zt,u as Kt,r as R,s as Xt,o as Yt,b as ut,c as Qt,e as Zt,f as te,g as vt,a as ee}from"../chunks/stores.b743fa56.js";class At{constructor(t,e,a,s,o,u){g(this,"xPos");g(this,"yPos");g(this,"color","0,0,0");g(this,"alpha",1);g(this,"gamectx");g(this,"gameCanvas");this.gamectx=o,this.gameCanvas=u,this.xPos=t,this.yPos=e,this.color=a,this.alpha=s}draw(){}equals(t){return!0}setColor(t){console.log("settings color: "+t)}hideMe(){console.log("Hiding me :(")}displayMe(){console.log("Displaing me :)")}}class Dt extends At{constructor(e,a,s,o,u,p,f,c){super(e,a,u,p,f,c);g(this,"radius");g(this,"endAngle",2);this.radius=s,this.endAngle=o,this.draw()}draw(){let[e,a,s]=this.color.split(",");this.gamectx.beginPath(),this.gamectx.fillStyle=`rgba(${e}, ${a}, ${s}, ${this.alpha})`,this.gamectx.arc(this.xPos,this.yPos,this.radius,0,Math.PI*this.endAngle),this.gamectx.closePath(),this.gamectx.fill()}equals(e){return this.alpha===e.alpha&&this.color===e.color&&this.endAngle===e.endAngle&&this.radius===e.radius&&this.xPos===e.xPos&&this.yPos===e.yPos}}class ae extends At{draw(){}}class Ht{constructor(t,e){g(this,"xPosMouse");g(this,"yPosMouse");g(this,"currentShape");g(this,"controlsCanvas");g(this,"hasPainted",!1);g(this,"stoppedPaintingJustNow",!1);g(this,"oldLengths");g(this,"shapes");g(this,"drawInterval");g(this,"gamectx");g(this,"gameCanvas");g(this,"gameCanvasString");this.controlsCanvas=e,this.gameCanvasString=t,this.shapes={rectangles:[],circles:[]},this.currentShape="circle",this.oldLengths={rectangles:0,circles:0}}run(){if(this.gameCanvas=document.getElementById(this.gameCanvasString),this.gameCanvas==null)throw new Error("Game Canvas is null!");this.gamectx=this.gameCanvas.getContext("2d"),this.gameCanvas.height=window.innerHeight,this.gameCanvas.width=window.innerWidth,setInterval(()=>this.updateHasPainted(),500),this.gameCanvas.addEventListener("mousemove",t=>{this.xPosMouse=t.clientX,this.yPosMouse=Math.round(t.clientY-this.gameCanvas.getBoundingClientRect().top)}),this.gameCanvas.addEventListener("mousedown",t=>{this.drawInterval=setInterval(()=>this.drawCurrentShape(t),50)}),this.gameCanvas.addEventListener("mouseup",()=>{clearInterval(this.drawInterval)}),this.gameCanvas.addEventListener("mouseout",()=>{clearInterval(this.drawInterval)})}async updateHasPainted(){let t=!1;for(const e of Object.keys(this.shapes))this.shapes[e].length!==this.oldLengths[e]&&(t=!0,this.oldLengths[e]=this.shapes[e].length);this.hasPainted=t}drawCurrentShape(t){let e=.7;if(this.currentShape=="circle"){let a=10,s=2;this.shapes.circles.push(new Dt(this.xPosMouse,this.yPosMouse,a,s,"00, 00, 255",e,this.gamectx,this.gameCanvas))}else this.currentShape=="rectangle"&&this.shapes.rectangles.push(new ae(this.xPosMouse,this.yPosMouse,"255,00,00",e,this.gamectx,this.gameCanvas))}drawAllShapes(){if(this.shapes!==null)for(const t of Object.keys(this.shapes))this.shapes[t].forEach(e=>{e.draw()})}getShapes(){let t={},e;for(const a of Object.keys(this.shapes)){t[a]=[];for(const s of this.shapes[a])e={alpha:s.alpha,color:s.color,endAngle:2,radius:10,xPos:s.xPos,yPos:s.yPos},t[a].push(e)}return t}thinCanvas(){for(const t of Object.keys(this.shapes))for(let e=0;e<this.shapes[t].length;){if(this.shapes[t].length===0)continue;let a=this.shapes[t][e],s=0;if(this.shapes[t].forEach(o=>{a.equals(o)&&s++}),s>1){let o=this.shapes[t].indexOf(a);this.shapes[t].splice(o,1)}else e++}}reloadContext(t){this.gamectx.clearRect(0,0,this.gameCanvas.width,this.gameCanvas.height),this.shapes={rectangles:[],circles:[]};for(const e of Object.keys(t))t[e].forEach(a=>{this.shapes[e].push(new Dt(a.xPos,a.yPos,a.radius,a.endAngle,a.color,a.alpha,this.gamectx,a.gameCanvas))})}}class Vt{constructor(t,e,a){g(this,"painter");g(this,"Networker");g(this,"game");g(this,"canvasWrapper");g(this,"drawButton");this.painter=t,this.Networker=e,this.game=a}async obtainCanvasControl(){try{let t=await this.Networker.requestCanvasControl();this.unlockCanvas()}catch(t){this.animationNotLoggedInButton(),console.log("Couldn't obtain canvas control:"),console.log(t)}}async animationNotLoggedInButton(){this.drawButton.style.backgroundColor="red",await new Promise(t=>setTimeout(t,600)),this.drawButton.style.backgroundColor="green",await new Promise(t=>setTimeout(t,400)),this.drawButton.style.backgroundColor="red",await new Promise(t=>setTimeout(t,200)),this.drawButton.style.backgroundColor="green",await new Promise(t=>setTimeout(t,200)),this.drawButton.style.backgroundColor="red",await new Promise(t=>setTimeout(t,1e3)),this.drawButton.style.backgroundColor=""}lockCanvas(){this.painter.controlsCanvas=!1,this.canvasWrapper.style.pointerEvents="none",this.canvasWrapper.style.cursor="not-allowed",this.painter.stoppedPaintingJustNow=!0,this.Networker.initiateShapeRetrieval(),this.drawButton.style.backgroundColor=""}unlockCanvas(){this.canvasWrapper.style.pointerEvents="",this.canvasWrapper.style.cursor="",this.Networker.stopShapeRetrieval(),this.painter.controlsCanvas=!0,this.drawButton.style.backgroundColor="green"}run(){if(this.canvasWrapper=document.getElementById("canvas-wrapper"),this.drawButton=document.getElementById("button-Draw-drawing-pane"),this.game instanceof Lt){let e=document.getElementById("canvas-wrapper");e.style.pointerEvents="none",e.style.cursor="not-allowed"}document.getElementById("button-Draw-drawing-pane").addEventListener("click",async()=>{this.painter.controlsCanvas?(this.lockCanvas(),await this.Networker.removeCanvasControl()):this.obtainCanvasControl()})}}class Tt{constructor(t,e){g(this,"painter");g(this,"database");g(this,"canvasID");g(this,"stopShapeRetrieval");this.canvasID=e,this.painter=t,this.database=pt(zt)}async updateShapes(t){try{let e=this.canvasID+"/shapes",a=await this.sendUpdate(t,e)}catch(e){return console.log("Update failed"),console.log(e),!1}return!0}async setShapes(t){try{let e=await this.sendSet(t,this.canvasID);console.log("Set: successful")}catch(e){return console.log("Send shapes error:"),console.log(e),!1}return!0}async sendUpdate(t,e){let a={};a[e]=t,await Kt(R(this.database),a)}async sendSet(t,e){await Xt(R(this.database,e),t)}initiateShapeRetrieval(){let t=this.canvasID+"/shapes";this.stopShapeRetrieval=Yt(R(this.database,t),e=>{let a=e.val();a===null&&(a={}),this.painter.reloadContext(a)})}async canvasIsControlled(t){try{if(!(await ut(R(this.database,t))).exists())return!1}catch(e){return console.log("(canvasIsControlled) Failure:"),console.log(e),!1}return!0}async canvasExists(){return new Promise(async(t,e)=>{console.log("looking if canvas exists in networker");let a="/"+this.canvasID;try{if(!(await ut(R(this.database,a))).exists()){e(!1);return}}catch(s){console.log(s),e(!1);return}t(!0)})}async requestCanvasControl(){return new Promise(async(t,e)=>{let a=localStorage.getItem("email");if(a===null){e("(reuquestCanvasControl) user email doens't exist in localstorage");return}a=encodeURIComponent(a).replace(".","%2E");let s=this.canvasID+"/control";if(await this.canvasIsControlled(s)){e("(requestCanvasControl) canvas is being controlled by someone else");return}await this.sendUpdate(a,s);try{let o=await ut(R(this.database,s));if(!o.exists()){e("(requestCanvasControl) no email exists even though we tried to grab control");return}if(o.val()!==a){e("Another user controls the canvas");return}}catch{e("(requestCanvasControl) fireGet failed when checking if we got control:");return}t("Successfully grabbed control over canvas")})}async removeCanvasControl(){let t=this.canvasID+"/control";await Qt(R(this.database,t))}run(){this.initiateShapeRetrieval()}}class Mt{constructor(t){g(this,"canvasID");g(this,"painter");g(this,"settingsHandler");g(this,"networker");g(this,"intervalAsyncTimer");this.canvasID=t,window.onbeforeunload=()=>{this.cleanUp()}}async transmitShapes(){if(this.painter.stoppedPaintingJustNow){this.painter.stoppedPaintingJustNow=!1;return}if(!this.painter.controlsCanvas||!this.painter.hasPainted)return;this.painter.hasPainted=!1;let t=this.painter.getShapes();try{let e=await this.networker.updateShapes(t)}catch{console.log("Transimitting shapes didn't go as planned")}}initTransmissions(){this.intervalAsyncTimer=Zt.setIntervalAsync(async()=>{await this.transmitShapes()},50),setInterval(()=>{this.painter.controlsCanvas&&this.painter.thinCanvas()},5e3)}run(){}cleanUp(){te(this.intervalAsyncTimer),this.painter.controlsCanvas&&this.networker.removeCanvasControl()}}class se extends Mt{constructor(t,e){super(e),this.painter=new Ht(t,!0),this.networker=new Tt(this.painter,this.canvasID),this.settingsHandler=new Vt(this.painter,this.networker,this)}run(){console.log("Host: running game")}}class Lt extends Mt{constructor(t,e){super(e),this.painter=new Ht(t,!1),this.networker=new Tt(this.painter,this.canvasID),this.settingsHandler=new Vt(this.painter,this.networker,this)}async canvasExists(){let t;try{return t=await this.networker.canvasExists(),t}catch(e){return e}}run(){console.log("Client: running game"),this.settingsHandler.run(),this.painter.run(),this.networker.run(),this.initTransmissions()}}function ne(i,t){let e=document.getElementById(i);e==null&&console.log("Trying to fuse attributes to "+i+", but it is null or undifined!");for(const[a,s]of Object.entries(t))e==null||e.setAttribute(a,s)}function Ot(i){let t=document.getElementById(i);document.getElementsByClassName("modal-backdrop")[0].remove(),t.style.display="none"}function St(i,t,e){const a=i.slice();return a[3]=t[e],a[5]=e,a}function Bt(i){let t,e=i[1][i[5]]+"",a;return{c(){t=h("a"),a=T(e),this.h()},l(s){t=d(s,"A",{id:!0,class:!0,href:!0});var o=v(t);a=M(o,e),o.forEach(l),this.h()},h(){n(t,"id","anchor-"+i[3]),n(t,"class","col text-center btn btn-outline-secondary svelte-1d4vcpx"),n(t,"href",i[3])},m(s,o){J(s,t,o),r(t,a)},p:U,d(s){s&&l(t)}}}function re(i){let t,e,a,s,o=i[0],u=[];for(let p=0;p<o.length;p+=1)u[p]=Bt(St(i,o,p));return a=new Jt({}),{c(){t=h("nav");for(let p=0;p<u.length;p+=1)u[p].c();e=k(),Y(a.$$.fragment),this.h()},l(p){t=d(p,"NAV",{id:!0,class:!0});var f=v(t);for(let c=0;c<u.length;c+=1)u[c].l(f);e=P(f),Q(a.$$.fragment,f),f.forEach(l),this.h()},h(){n(t,"id","bottom-navbar"),n(t,"class","navbar fixed-bottom row padding-bottom justify-content-center d-flex svelte-1d4vcpx")},m(p,f){J(p,t,f);for(let c=0;c<u.length;c+=1)u[c]&&u[c].m(t,null);r(t,e),Z(a,t,null),s=!0},p(p,[f]){if(f&3){o=p[0];let c;for(c=0;c<o.length;c+=1){const y=St(p,o,c);u[c]?u[c].p(y,f):(u[c]=Bt(y),u[c].c(),u[c].m(t,e))}for(;c<u.length;c+=1)u[c].d(1);u.length=o.length}},i(p){s||(tt(a.$$.fragment,p),s=!0)},o(p){et(a.$$.fragment,p),s=!1},d(p){p&&l(t),Ut(u,p),at(a)}}}function oe(i){let t=["/home",""],e=["Settings","I am bored"];function a(){let s={"data-bs-toggle":"modal","data-bs-target":"#modal-game-type"},o="anchor-"+t.at(1);ne(o,s)}return Nt(a),[t,e]}class ie extends st{constructor(t){super(),nt(this,t,oe,re,rt,{})}}function le(i){let t,e,a,s,o,u,p,f,c,y,w,m,N;return{c(){t=h("main"),e=h("div"),a=h("form"),s=h("div"),o=h("label"),u=T("Canvas Name"),p=k(),f=h("input"),c=k(),y=h("div"),w=h("div"),m=h("a"),N=T("Connect"),this.h()},l($){t=d($,"MAIN",{});var b=v(t);e=d(b,"DIV",{class:!0});var C=v(e);a=d(C,"FORM",{class:!0,action:!0});var _=v(a);s=d(_,"DIV",{class:!0});var x=v(s);o=d(x,"LABEL",{class:!0,for:!0});var E=v(o);u=M(E,"Canvas Name"),E.forEach(l),p=P(x),f=d(x,"INPUT",{class:!0,type:!0}),x.forEach(l),c=P(_),y=d(_,"DIV",{class:!0});var I=v(y);w=d(I,"DIV",{class:!0});var H=v(w);m=d(H,"A",{id:!0,class:!0,href:!0});var D=v(m);N=M(D,"Connect"),D.forEach(l),H.forEach(l),I.forEach(l),_.forEach(l),C.forEach(l),b.forEach(l),this.h()},h(){n(o,"class","col"),n(o,"for",""),n(f,"class","col rounded"),n(f,"type","text"),n(s,"class","row"),n(m,"id","anchor-game"),n(m,"class","col text-center btn btn-outline-secondary"),n(m,"href",""),n(w,"class","col d-flex justify-content-center"),n(y,"class","row"),n(a,"class","row"),n(a,"action",""),n(e,"class","row d-flex justify-content-center")},m($,b){J($,t,b),r(t,e),r(e,a),r(a,s),r(s,o),r(o,u),r(s,p),r(s,f),r(a,c),r(a,y),r(y,w),r(w,m),r(m,N)},p:U,i:U,o:U,d($){$&&l(t)}}}let ce="context-id-1";function he(i){let t,e=!0;return Nt(()=>{let a=document.getElementById("anchor-game");a==null||a.addEventListener("click",async s=>{if(s.target===null)throw Error("event is null");if(e){if(console.log("klickat på anchor"),Ot("modal-game-type"),vt.set(new Lt("game-canvas",ce)),t=pt(vt),!await t.canvasExists()){console.log("Canvas doesn't exist, do something about it");return}console.log("den finns!"),console.log(s.target),e=!1,s.target.click();return}s.target.href="/game/client"})}),[]}class de extends st{constructor(t){super(),nt(this,t,he,le,rt,{})}}function ue(i){let t,e,a,s,o,u,p,f,c,y,w,m,N,$,b;return{c(){t=h("main"),e=h("div"),a=h("form"),s=h("div"),o=h("label"),u=T("Canvas Name"),p=k(),f=h("input"),c=k(),y=h("div"),w=h("div"),m=h("a"),N=T("Host"),this.h()},l(C){t=d(C,"MAIN",{});var _=v(t);e=d(_,"DIV",{class:!0});var x=v(e);a=d(x,"FORM",{class:!0,action:!0});var E=v(a);s=d(E,"DIV",{class:!0});var I=v(s);o=d(I,"LABEL",{class:!0,for:!0});var H=v(o);u=M(H,"Canvas Name"),H.forEach(l),p=P(I),f=d(I,"INPUT",{class:!0,type:!0}),I.forEach(l),c=P(E),y=d(E,"DIV",{class:!0});var D=v(y);w=d(D,"DIV",{class:!0});var V=v(w);m=d(V,"A",{class:!0,href:!0});var A=v(m);N=M(A,"Host"),A.forEach(l),V.forEach(l),D.forEach(l),E.forEach(l),x.forEach(l),_.forEach(l),this.h()},h(){n(o,"class","col"),n(o,"for",""),n(f,"class","col rounded"),n(f,"type","text"),n(s,"class","row"),n(m,"class","col text-center btn btn-outline-secondary"),n(m,"href","/game/host"),n(w,"class","col d-flex justify-content-center"),n(y,"class","row"),n(a,"class","row"),n(a,"action",""),n(e,"class","row d-flex justify-content-center")},m(C,_){J(C,t,_),r(t,e),r(e,a),r(a,s),r(s,o),r(o,u),r(s,p),r(s,f),Pt(f,i[0]),r(a,c),r(a,y),r(y,w),r(w,m),r(m,N),$||(b=[$t(f,"input",i[2]),$t(m,"click",i[1])],$=!0)},p(C,[_]){_&1&&f.value!==C[0]&&Pt(f,C[0])},i:U,o:U,d(C){C&&l(t),$=!1,jt(b)}}}function ve(i,t,e){let a="";function s(){Ot("modal-game-type"),console.log("navigating to host from connectorhost"),vt.set(new se("game-canvas",a))}function o(){a=this.value,e(0,a)}return[a,s,o]}class pe extends st{constructor(t){super(),nt(this,t,ve,ue,rt,{})}}function ge(i){let t,e,a,s,o,u,p,f,c,y,w,m,N,$,b,C,_,x,E,I,H,D,V,A,ot,G,it,O,j,lt,ct,W,F,ht,q,dt,z;return I=new pe({}),A=new de({}),q=new ie({}),{c(){t=h("main"),e=h("div"),a=h("div"),s=h("div"),o=h("div"),u=h("h5"),p=T("Open drawing pane"),f=k(),c=h("button"),y=k(),w=h("div"),m=h("button"),N=T("Host"),$=k(),b=h("button"),C=T("Connect"),_=k(),x=h("div"),E=h("div"),Y(I.$$.fragment),H=k(),D=h("div"),V=h("div"),Y(A.$$.fragment),ot=k(),G=h("div"),it=k(),O=h("div"),j=h("p"),lt=T("ipsumquam ducimus"),ct=k(),W=h("div"),F=h("div"),ht=k(),Y(q.$$.fragment),this.h()},l(S){t=d(S,"MAIN",{class:!0});var B=v(t);e=d(B,"DIV",{id:!0,class:!0,tabindex:!0});var gt=v(e);a=d(gt,"DIV",{class:!0});var ft=v(a);s=d(ft,"DIV",{class:!0});var L=v(s);o=d(L,"DIV",{class:!0});var K=v(o);u=d(K,"H5",{class:!0});var mt=v(u);p=M(mt,"Open drawing pane"),mt.forEach(l),f=P(K),c=d(K,"BUTTON",{type:!0,class:!0,"data-bs-dismiss":!0,"aria-label":!0}),v(c).forEach(l),K.forEach(l),y=P(L),w=d(L,"DIV",{class:!0});var X=v(w);m=d(X,"BUTTON",{class:!0,type:!0,"data-bs-toggle":!0,"data-bs-target":!0,"aria-expanded":!0,"aria-controls":!0});var wt=v(m);N=M(wt,"Host"),wt.forEach(l),$=P(X),b=d(X,"BUTTON",{class:!0,type:!0,"data-bs-toggle":!0,"data-bs-target":!0,"aria-expanded":!0,"aria-controls":!0});var yt=v(b);C=M(yt,"Connect"),yt.forEach(l),X.forEach(l),_=P(L),x=d(L,"DIV",{class:!0,id:!0});var bt=v(x);E=d(bt,"DIV",{class:!0});var Ct=v(E);Q(I.$$.fragment,Ct),Ct.forEach(l),bt.forEach(l),H=P(L),D=d(L,"DIV",{class:!0,id:!0});var _t=v(D);V=d(_t,"DIV",{class:!0});var xt=v(V);Q(A.$$.fragment,xt),xt.forEach(l),_t.forEach(l),L.forEach(l),ft.forEach(l),gt.forEach(l),ot=P(B),G=d(B,"DIV",{class:!0}),v(G).forEach(l),it=P(B),O=d(B,"DIV",{id:!0,class:!0});var It=v(O);j=d(It,"P",{class:!0});var Et=v(j);lt=M(Et,"ipsumquam ducimus"),Et.forEach(l),It.forEach(l),ct=P(B),W=d(B,"DIV",{class:!0});var kt=v(W);F=d(kt,"DIV",{}),v(F).forEach(l),kt.forEach(l),ht=P(B),Q(q.$$.fragment,B),B.forEach(l),this.h()},h(){n(u,"class","modal-title"),n(c,"type","button"),n(c,"class","btn-close"),n(c,"data-bs-dismiss","modal"),n(c,"aria-label","Close"),n(o,"class","modal-header"),n(m,"class","col btn btn-primary"),n(m,"type","button"),n(m,"data-bs-toggle","collapse"),n(m,"data-bs-target","#connector-host"),n(m,"aria-expanded","false"),n(m,"aria-controls","connector-host"),n(b,"class","col btn btn-primary"),n(b,"type","button"),n(b,"data-bs-toggle","collapse"),n(b,"data-bs-target","#connector-client"),n(b,"aria-expanded","false"),n(b,"aria-controls","connector-client"),n(w,"class","modal-body row"),n(E,"class","card card-body d-flex justify-content-center"),n(x,"class","collapse"),n(x,"id","connector-host"),n(V,"class","card card-body"),n(D,"class","collapse"),n(D,"id","connector-client"),n(s,"class","modal-content"),n(a,"class","modal-dialog"),n(e,"id","modal-game-type"),n(e,"class","modal"),n(e,"tabindex","-1"),n(G,"class","col-1 border bg-danger"),n(j,"class","display-2"),n(O,"id","content"),n(O,"class","col bg-info text-white"),n(W,"class","col-1 border bg-danger"),n(t,"class","row d-flex justify-content-center text-info")},m(S,B){J(S,t,B),r(t,e),r(e,a),r(a,s),r(s,o),r(o,u),r(u,p),r(o,f),r(o,c),r(s,y),r(s,w),r(w,m),r(m,N),r(w,$),r(w,b),r(b,C),r(s,_),r(s,x),r(x,E),Z(I,E,null),r(s,H),r(s,D),r(D,V),Z(A,V,null),r(t,ot),r(t,G),r(t,it),r(t,O),r(O,j),r(j,lt),r(t,ct),r(t,W),r(W,F),r(t,ht),Z(q,t,null),z=!0},p:U,i(S){z||(tt(I.$$.fragment,S),tt(A.$$.fragment,S),tt(q.$$.fragment,S),dt||Wt(()=>{dt=Gt(t,Ft,{axis:"x",duration:700}),dt.start()}),z=!0)},o(S){et(I.$$.fragment,S),et(A.$$.fragment,S),et(q.$$.fragment,S),z=!1},d(S){S&&l(t),at(I),at(A),at(q)}}}function fe(i){return pt(ee),[]}class _e extends st{constructor(t){super(),nt(this,t,fe,ge,rt,{})}}export{_e as default};
